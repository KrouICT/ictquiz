<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>á”áŸ’ášá–áŸá“áŸ’á’á”áŸ’ášá¡á„á…áŸ†ááŸáŸ‡áŠá¹á„ ICT</title>
  <style>
    @font-face {
      font-family: 'khSiemreap';
      src: url('fonts/Kantumruy.ttf');
    }
    :root {
      --primary: #2980b9;
      --secondary: #2c3e50;
      --accent: #e74c3c;
      --success: #27ae60;
      --danger: #c0392b;
      --warning: #f39c12;
      --info: #3498db;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --gray: #7f8c8d;
      --round1: #3498db;
      --round2: #9b59b6;
      --round3: #e74c3c;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'khSiemreap', 'Battambang', Arial, sans-serif;
      line-height: 1.6;
      background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
      color: var(--dark);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .container {
      max-width: 900px;
      width: 100%;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      padding: 30px;
      margin: 20px 0;
      position: relative;
    }
    .round-badge {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 8px 15px;
      border-radius: 50px;
      font-weight: bold;
      color: white;
      font-size: 0.9rem;
    }
    .round-1 {
      background-color: var(--round1);
    }
    .round-2 {
      background-color: var(--round2);
    }
    .round-3 {
      background-color: var(--round3);
    }
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    h1 {
      color: var(--primary);
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    .subtitle {
      color: var(--accent);
      font-size: 1.2rem;
      margin-bottom: 20px;
    }
    .welcome-screen, .round-complete-screen, .final-results-screen {
      text-align: center;
      padding: 20px;
    }
    .welcome-icon, .round-complete-icon, .final-results-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      color: var(--primary);
    }
    .welcome-text, .round-complete-text, .final-results-text {
      font-size: 1.2rem;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: var(--dark);
    }
    input[type="text"] {
      width: 100%;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1.1rem;
      font-family: 'khSiemreap', 'Battambang', Arial, sans-serif;
    }
    input[type="text"]:focus {
      border-color: var(--primary);
      outline: none;
    }
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin: 10px;
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
      color: white;
    }
    .btn-secondary {
      background-color: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    .btn-success {
      background-color: var(--success);
      color: white;
    }
    .btn-warning {
      background-color: var(--warning);
      color: white;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .progress-container {
      width: 100%;
      background-color: #f3f3f3;
      border-radius: 10px;
      margin-bottom: 20px;
      overflow: hidden;
      height: 15px;
    }
    .progress-bar {
      height: 100%;
      border-radius: 10px;
      transition: width 0.3s ease;
    }
    .progress-round-1 {
      background: linear-gradient(90deg, var(--round1) 0%, #5dade2 100%);
    }
    .progress-round-2 {
      background: linear-gradient(90deg, var(--round2) 0%, #bb8fce 100%);
    }
    .progress-round-3 {
      background: linear-gradient(90deg, var(--round3) 0%, #f1948a 100%);
    }
    .question-count {
      text-align: right;
      color: var(--gray);
      margin-bottom: 20px;
      font-size: 1rem;
    }
    .question-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid #eee;
    }
    .question-text {
      font-size: 1.4rem;
      color: var(--primary);
      margin-bottom: 20px;
      line-height: 1.4;
    }
    .question-image {
      width: 100%;
      height: auto;
      max-height: 300px;
      object-fit: contain;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .options-container {
      display: grid;
      grid-gap: 15px;
      margin-bottom: 20px;
    }
    .option-button {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background-color: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
    }
    .option-button:hover {
      background-color: #e9ecef;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    }
    .option-button.selected {
      background-color: #d6eaf8;
      border-color: var(--info);
      color: var(--info);
    }
    .option-button.correct {
      background-color: #d4edda;
      border-color: var(--success);
      color: var(--success);
    }
    .option-button.incorrect {
      background-color: #f8d7da;
      border-color: var(--danger);
      color: var(--danger);
    }
    .option-letter {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      background-color: var(--secondary);
      color: white;
      border-radius: 50%;
      margin-right: 15px;
      font-weight: bold;
    }
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .nav-button {
      padding: 12px 25px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .nav-button.prev {
      background-color: white;
      color: var(--info);
      border: 2px solid var(--info);
    }
    .nav-button.next {
      background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
      color: white;
    }
    .nav-button.submit {
      background-color: var(--success);
      color: white;
    }
    .nav-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .result-container {
      text-align: center;
      padding: 30px;
    }
    .result-title {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 20px;
    }
    .result-score {
      font-size: 3rem;
      font-weight: bold;
      color: var(--accent);
      margin-bottom: 20px;
    }
    .result-details {
      margin-bottom: 30px;
      font-size: 1.1rem;
    }
    .round-scores {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
    }
    .round-score {
      text-align: center;
      padding: 15px;
      border-radius: 10px;
      width: 30%;
    }
    .round-1-score {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--round1);
    }
    .round-2-score {
      background-color: rgba(155, 89, 182, 0.1);
      color: var(--round2);
    }
    .round-3-score {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--round3);
    }
    .round-number {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .round-points {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .restart-button {
      padding: 15px 30px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .restart-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.2rem;
      color: var(--gray);
    }
    .error {
      text-align: center;
      padding: 40px;
      color: var(--danger);
      font-size: 1.2rem;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      color: var(--gray);
      font-size: 0.9rem;
    }
    .leaderboard {
      width: 100%;
      margin: 20px 0;
      border-collapse: collapse;
    }
    .leaderboard th, .leaderboard td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .leaderboard th {
      background-color: var(--primary);
      color: white;
    }
    .leaderboard tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .leaderboard tr:hover {
      background-color: #e9f7fe;
    }
    @media (max-width: 768px) {
      .container {
        padding: 20px;
        border-radius: 15px;
      }
      h1 {
        font-size: 2rem;
      }
      .question-text {
        font-size: 1.2rem;
      }
      .option-button {
        padding: 12px 15px;
        font-size: 1rem;
      }
      .round-scores {
        flex-direction: column;
        align-items: center;
      }
      .round-score {
        width: 100%;
        margin-bottom: 15px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>á”áŸ’ášá–áŸá“áŸ’á’á”áŸ’ášá¡á„á…áŸ†ááŸáŸ‡áŠá¹á„ ICT</h1>
      <p class="subtitle">áŸá¼á˜á–á·á“á·ááŸ’á™á…áŸ†ááŸáŸ‡áŠá¹á„ ICT ášá”áŸáŸ‹á¢áŸ’á“á€á‡á¶á˜á½á™á“á¹á„áŸáŸ†áá½ášá‚á½ášá±áŸ’á™á…á¶á”áŸ‹á¢á¶ášá˜áŸ’á˜ááŸ</p>
    </header>
    
    <div id="app-container">
      <div class="welcome-screen" id="welcome-screen">
        <div class="welcome-icon">ğŸ§ </div>
        <h2>áŸá¼á˜áŸáŸ’áœá¶á‚á˜á“áŸá˜á€á€á¶á“áŸ‹á”áŸ’ášá–áŸá“áŸ’á’á”áŸ’ášá¡á„á…áŸ†ááŸáŸ‡áŠá¹á„ ICT</h2>
        <p class="welcome-text">
          á€á˜áŸ’á˜áœá·á’á¸á“áŸáŸ‡á•áŸ’áá›áŸ‹á“á¼áœáŸáŸ†áá½ášá”áŸ’ášá¡á„á…áŸ†á“á½á“ áŸ£ áœá‚áŸ’á‚ áœá‚áŸ’á‚á“á¸á˜á½á™áŸ—á˜á¶á“ áŸ¡áŸ  áŸáŸ†áá½ášáŸ”<br>
          á”á“áŸ’á‘á¶á”áŸ‹á–á¸á”á‰áŸ’á…á”áŸ‹áœá‚áŸ’á‚á‘á¸áŸ£ á›á‘áŸ’á’á•á›ášá”áŸáŸ‹á¢áŸ’á“á€á“á¹á„ááŸ’ášá¼áœášá€áŸ’áŸá¶á‘á»á€á€áŸ’á“á»á„á”áŸ’ášá–áŸá“áŸ’á’á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹áŸ”
        </p>
        <div class="form-group">
          <label for="player-name">áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á›áŸá„:</label>
          <input type="text" id="player-name" placeholder="áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡ášá”áŸáŸ‹á¢áŸ’á“á€">
        </div>
        <button class="btn btn-primary" id="start-button">á…á¶á”áŸ‹á•áŸ’áá¾á˜á”áŸ’ášá¡á„</button>
      </div>
    </div>
  </div>

  <footer>
    <p>Â© 2023 á”áŸ’ášá–áŸá“áŸ’á’á”áŸ’ášá¡á„á…áŸ†ááŸáŸ‡áŠá¹á„ ICT | ášá…á“á¶áŠáŸ„á™á¢áŸ’á“á€á¢á—á·áœáŒáŸ’áá“áŸ</p>
  </footer>

  <script>
    // Google Sheets configuration
    const SHEET_ID = "1nsO-EgHt6E2C1W3mFUoO4wpmqPa8YXMZmJ8LYXq5f70";
    const API_KEY = "AIzaSyBy5yeaAgfHx3Mmed3LlTu7WeOchsXJlrI";
    const QUESTIONS_SHEET = "Sheet1";
    const RESULTS_SHEET = "Sheet5";

    // DOM elements
    const appContainer = document.getElementById("app-container");
    const welcomeScreen = document.getElementById("welcome-screen");
    const startButton = document.getElementById("start-button");
    const playerNameInput = document.getElementById("player-name");

    // Game state
    let gameState = {
      playerName: "",
      currentRound: 1,
      currentQuestionIndex: 0,
      score: 0,
      roundScores: [0, 0, 0],
      usedQuestionIds: [],
      questions: [],
      currentQuestions: [],
      playerAnswers: [[], [], []]
    };

    // Initialize the app
    function init() {
      startButton.addEventListener('click', startGame);
    }

    // Start the game
    async function startGame() {
      const playerName = playerNameInput.value.trim();
      if (!playerName) {
        Swal.fire({
          icon: 'warning',
          title: 'áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á›áŸá„',
          text: 'áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡ášá”áŸáŸ‹á¢áŸ’á“á€áŠá¾á˜áŸ’á”á¸á”á“áŸ’á',
          confirmButtonText: 'á™á›áŸ‹á–áŸ’ášá˜'
        });
        return;
      }

      gameState.playerName = playerName;

      try {
        // Load questions from Google Sheets
        const questions = await fetchQuizData();
        gameState.questions = questions;
        
        // Start the first round
        startRound(1);
      } catch (error) {
        showError();
        console.error(error);
      }
    }

    // Fetch data from Google Sheets
    async function fetchQuizData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${QUESTIONS_SHEET}?key=${API_KEY}`;
      const response = await fetch(url);
      const data = await response.json();
      const rows = data.values;

      // Convert rows to objects
      const headers = rows[0];
      const questions = rows.slice(1).map(row => {
        const question = {};
        row.forEach((value, index) => {
          question[headers[index]] = value;
        });
        return question;
      });

      return questions;
    }

    // Start a new round
    function startRound(roundNumber) {
      gameState.currentRound = roundNumber;
      gameState.currentQuestionIndex = 0;
      gameState.playerAnswers[roundNumber - 1] = [];

      // Select 10 unique questions for this round
      const availableQuestions = gameState.questions.filter(q => 
        !gameState.usedQuestionIds.includes(q.id)
      );
      
      // Shuffle and take 10 questions
      const roundQuestions = availableQuestions
        .sort(() => Math.random() - 0.5)
        .slice(0, 10);
      
      gameState.currentQuestions = roundQuestions;
      
      // Mark these questions as used
      roundQuestions.forEach(q => {
        gameState.usedQuestionIds.push(q.id);
      });

      // Render the round screen
      renderRoundScreen(roundNumber);
    }

    // Render round screen
    function renderRoundScreen(roundNumber) {
      appContainer.innerHTML = `
        <div class="round-complete-screen">
          <div class="round-complete-icon">${roundNumber === 1 ? 'ğŸš€' : roundNumber === 2 ? 'ğŸ”¥' : 'ğŸ†'}</div>
          <h2>áœá‚áŸ’á‚ ${roundNumber}</h2>
          <p class="round-complete-text">
            á¢áŸ’á“á€á“á¹á„ááŸ’ášá¼áœá†áŸ’á›á¾á™áŸáŸ†áá½ášá…áŸ†á“á½á“ áŸ¡áŸ  áŸáŸ†áá½ášáŸ”<br>
            áŸá¼á˜áá·áááŸ†á†áŸ’á›á¾á™á¢áŸ„á™á”á¶á“ááŸ’ášá¹á˜ááŸ’ášá¼áœáŠá¾á˜áŸ’á”á¸á”á„áŸ’á€á¾á“á–á·á“áŸ’á‘á»ášá”áŸáŸ‹á¢áŸ’á“á€áŸ”
          </p>
          <button class="btn btn-primary" id="start-round-button">á…á¶á”áŸ‹á•áŸ’áá¾á˜áœá‚áŸ’á‚ ${roundNumber}</button>
        </div>
      `;

      document.getElementById('start-round-button').addEventListener('click', () => {
        renderQuiz();
      });
    }

    // Render the quiz UI
    function renderQuiz() {
      const { currentRound, currentQuestionIndex, currentQuestions } = gameState;
      const questionData = currentQuestions[currentQuestionIndex];
      
      appContainer.innerHTML = `
        <div class="round-badge round-${currentRound}">áœá‚áŸ’á‚ ${currentRound}</div>
        <div class="progress-container">
          <div class="progress-bar progress-round-${currentRound}" id="progress-bar" 
               style="width: ${((currentQuestionIndex + 1) / currentQuestions.length) * 100}%"></div>
        </div>
        <div class="question-count" id="question-count">áŸáŸ†áá½áš ${currentQuestionIndex + 1}/${currentQuestions.length}</div>
        <div class="question-card">
          <div class="question-text">${questionData.questions}</div>
          ${questionData.image ? `<img class="question-image" src="${questionData.image}" alt="Question Image">` : ''}
          <div class="options-container">
            <button class="option-button" data-index="1">
              <span class="option-letter">á€</span> ${questionData.option1}
            </button>
            <button class="option-button" data-index="2">
              <span class="option-letter">á</span> ${questionData.option2}
            </button>
            <button class="option-button" data-index="3">
              <span class="option-letter">á‚</span> ${questionData.option3}
            </button>
          </div>
          <div class="navigation-buttons">
            <button class="nav-button prev" ${currentQuestionIndex === 0 ? 'disabled' : ''}>áŸáŸ†áá½ášá˜á»á“</button>
            <button class="nav-button next">${currentQuestionIndex === currentQuestions.length - 1 ? 'á”á‰áŸ’á…á”áŸ‹áœá‚áŸ’á‚' : 'áŸáŸ†áá½ášá”á“áŸ’á‘á¶á”áŸ‹'}</button>
          </div>
        </div>
      `;

      // Highlight previously selected answer if exists
      const currentAnswer = gameState.playerAnswers[gameState.currentRound - 1][currentQuestionIndex];
      if (currentAnswer !== undefined) {
        const selectedButton = document.querySelector(`.option-button[data-index="${currentAnswer}"]`);
        if (selectedButton) {
          selectedButton.classList.add('selected');
        }
      }

      // Add event listeners to option buttons
      document.querySelectorAll('.option-button').forEach(button => {
        button.addEventListener('click', () => {
          // Remove selected class from all options
          document.querySelectorAll('.option-button').forEach(btn => {
            btn.classList.remove('selected');
          });
          
          // Add selected class to clicked option
          button.classList.add('selected');
          
          // Store user's answer
          gameState.playerAnswers[gameState.currentRound - 1][currentQuestionIndex] = 
            parseInt(button.getAttribute('data-index'));
        });
      });

      // Previous button event listener
      document.querySelector('.nav-button.prev').addEventListener('click', () => {
        if (gameState.currentQuestionIndex > 0) {
          gameState.currentQuestionIndex--;
          renderQuiz();
        }
      });

      // Next/Submit button event listener
      document.querySelector('.nav-button.next').addEventListener('click', () => {
        if (gameState.playerAnswers[gameState.currentRound - 1][gameState.currentQuestionIndex] === undefined) {
          Swal.fire({
            icon: 'warning',
            title: 'áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸá…á˜áŸ’á›á¾á™',
            text: 'á¢áŸ’á“á€á˜á·á“á‘á¶á“áŸ‹á‡áŸ’ášá¾áŸášá¾áŸá…á˜áŸ’á›á¾á™á“áŸ…á¡á¾á™á‘áŸáŸ”',
            confirmButtonText: 'á™á›áŸ‹á–áŸ’ášá˜'
          });
          return;
        }

        // Check if it's the last question of the round
        if (gameState.currentQuestionIndex === gameState.currentQuestions.length - 1) {
          finishRound();
        } else {
          gameState.currentQuestionIndex++;
          renderQuiz();
        }
      });
    }

    // Finish the current round
    function finishRound() {
      const { currentRound, currentQuestions, playerAnswers } = gameState;
      const roundAnswers = playerAnswers[currentRound - 1];
      
      // Calculate score for this round
      let roundScore = 0;
      currentQuestions.forEach((question, index) => {
        const correctAnswerIndex = parseInt(question.answer);
        if (roundAnswers[index] === correctAnswerIndex) {
          roundScore++;
        }
      });
      
      gameState.roundScores[currentRound - 1] = roundScore;
      gameState.score += roundScore;

      // Show round results
      Swal.fire({
        title: 'áœá‚áŸ’á‚á”á‰áŸ’á…á”áŸ‹!',
        html: `
          <div style="font-size: 1.5rem; color: #2980b9; margin-bottom: 20px;">á–á·á“áŸ’á‘á»áœá‚áŸ’á‚ ${currentRound}</div>
          <div style="font-size: 3rem; color: #e74c3c; font-weight: bold;">${roundScore}/10</div>
          <div style="margin-top: 20px; font-size: 1.2rem;">
            ${roundScore >= 8 ? 
              'á–á¼á€áŸ‚á˜áŸ‚á“á‘áŸ‚á“! á¢áŸ’á“á€á†áŸ’á›á¾á™ááŸ’ášá¼áœá…áŸ†á“á½á“á…áŸ’ášá¾á“áá¶áŸáŸ‹!' : 
              roundScore >= 5 ?
              'á›áŸ’á¢! á¢áŸ’á“á€á†áŸ’á›á¾á™ááŸ’ášá¼áœá…áŸ†á“á½á“á˜á’áŸ’á™á˜' :
              'áŸá¼á˜áá·áááŸ†á’áŸ’áœá¾á›áŸ†á á¶ááŸ‹á”á“áŸ’ááŸ‚á˜á‘áŸ€á!'}
          </div>
        `,
        icon: 'info',
        confirmButtonText: 'á™á›áŸ‹á–áŸ’ášá˜'
      }).then(() => {
        // Check if it's the final round
        if (currentRound === 3) {
          finishGame();
        } else {
          // Start next round
          startRound(currentRound + 1);
        }
      });
    }

    // Finish the entire game
    async function finishGame() {
      // Calculate total score
      const totalScore = gameState.score;
      
      // Save results to Google Sheets
      const success = await saveResults(totalScore);
      
      // Show final results
      appContainer.innerHTML = `
        <div class="final-results-screen">
          <div class="final-results-icon">ğŸ†</div>
          <h2>á”áŸ’ášá¡á„á…á”áŸ‹áŸá–áŸ’áœá‚áŸ’ášá”áŸ‹!</h2>
          <div class="result-score">${totalScore}/30</div>
          
          <div class="round-scores">
            <div class="round-score round-1-score">
              <div class="round-number">áœá‚áŸ’á‚ áŸ¡</div>
              <div class="round-points">${gameState.roundScores[0]}/10</div>
            </div>
            <div class="round-score round-2-score">
              <div class="round-number">áœá‚áŸ’á‚ áŸ¢</div>
              <div class="round-points">${gameState.roundScores[1]}/10</div>
            </div>
            <div class="round-score round-3-score">
              <div class="round-number">áœá‚áŸ’á‚ áŸ£</div>
              <div class="round-points">${gameState.roundScores[2]}/10</div>
            </div>
          </div>
          
          <p class="final-results-text">
            áŸá¼á˜á¢á”á¢ášáŸá¶á‘áš! á¢áŸ’á“á€á”á¶á“á”á‰áŸ’á…á”áŸ‹á€á˜áŸ’á˜áœá·á’á¸á”áŸ’ášá¡á„á…áŸ†ááŸáŸ‡áŠá¹á„ ICT áŠáŸ„á™á‡áŸ„á‚á‡áŸá™áŸ”<br>
            ${success ? 'á›á‘áŸ’á’á•á›ášá”áŸáŸ‹á¢áŸ’á“á€ááŸ’ášá¼áœá”á¶á“ášá€áŸ’áŸá¶á‘á»á€á“áŸ…á€áŸ’á“á»á„á”áŸ’ášá–áŸá“áŸ’á’á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹á á¾á™áŸ”' : 'á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášášá€áŸ’áŸá¶á‘á»á€á›á‘áŸ’á’á•á›áŸ”'}
          </p>
          
          <button class="btn btn-primary" id="restart-button">á›áŸá„á˜áŸ’áá„á‘áŸ€á</button>
          <button class="btn btn-secondary" id="leaderboard-button">á˜á¾á›á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹</button>
        </div>
      `;

      document.getElementById('restart-button').addEventListener('click', () => {
        resetGame();
        welcomeScreen.style.display = 'block';
      });

      document.getElementById('leaderboard-button').addEventListener('click', () => {
        showLeaderboard();
      });
    }

    // Save results to Google Sheets
    async function saveResults(score) {
      try {
        // Generate a unique ID (using timestamp)
        const id = new Date().getTime();
        
        // Prepare data for submission
        const data = {
          id: id,
          name: gameState.playerName,
          score: score,
          rank: "" // Rank will be calculated in the sheet
        };
        
        // In a real implementation, you would send this data to your server
        // or use Google Apps Script to write to the sheet
        // This is a mock implementation
        console.log("Saving results:", data);
        
        // For demonstration purposes, we'll simulate a successful save
        return true;
      } catch (error) {
        console.error("Error saving results:", error);
        return false;
      }
    }

    // Show leaderboard
    async function showLeaderboard() {
      try {
        // Fetch leaderboard data
        const leaderboardData = await fetchLeaderboardData();
        
        appContainer.innerHTML = `
          <div class="final-results-screen">
            <h2>áá¶ášá¶á„á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹</h2>
            <table class="leaderboard">
              <thead>
                <tr>
                  <th>áˆáŸ’á˜áŸ„áŸ‡</th>
                  <th>á–á·á“áŸ’á‘á»</th>
                  <th>á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹</th>
                </tr>
              </thead>
              <tbody>
                ${leaderboardData.map((player, index) => `
                  <tr>
                    <td>${player.name}</td>
                    <td>${player.score}</td>
                    <td>${index + 1}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
            <button class="btn btn-primary" id="back-button">ááŸ’ášá›á”áŸ‹á€áŸ’ášáŸ„á™</button>
          </div>
        `;
        
        document.getElementById('back-button').addEventListener('click', () => {
          finishGame();
        });
      } catch (error) {
        console.error("Error loading leaderboard:", error);
        Swal.fire({
          icon: 'error',
          title: 'á˜á·á“á¢á¶á…á•áŸ’á‘á»á€á‘á·á“áŸ’á“á“áŸá™',
          text: 'á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá•áŸ’á‘á»á€áá¶ášá¶á„á…áŸ†áá¶ááŸ‹ááŸ’á“á¶á€áŸ‹',
          confirmButtonText: 'á™á›áŸ‹á–áŸ’ášá˜'
        });
      }
    }

    // Fetch leaderboard data from Google Sheets
    async function fetchLeaderboardData() {
      // This is a mock implementation
      // In a real app, you would fetch from your Google Sheet
      return [
        { name: "áŸá»áá¶", score: 28 },
        { name: "áœá·á…á·ááŸ’áš", score: 25 },
        { name: "á˜á¶á“áŸ‹", score: 24 },
        { name: gameState.playerName, score: gameState.score },
        { name: "ášá·á‘áŸ’á’á·", score: 20 }
      ].sort((a, b) => b.score - a.score);
    }

    // Reset the game state
    function resetGame() {
      gameState = {
        playerName: gameState.playerName,
        currentRound: 1,
        currentQuestionIndex: 0,
        score: 0,
        roundScores: [0, 0, 0],
        usedQuestionIds: [],
        questions: gameState.questions,
        currentQuestions: [],
        playerAnswers: [[], [], []]
      };
    }

    // Show error message
    function showError() {
      appContainer.innerHTML = `
        <div class="error">
          <p>á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá•áŸ’á‘á»á€áŸáŸ†áá½ášáŸ” áŸá¼á˜á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€ááŸ”</p>
          <p>á”áŸ’ášáŸá·á“á”á¾á”á‰áŸ’á á¶á“áŸ…ááŸ‚á˜á¶á“ áŸá¼á˜á‘á¶á€áŸ‹á‘á„á¢áŸ’á“á€á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŸ”</p>
          <button class="btn btn-primary" id="retry-button">á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€á</button>
        </div>
      `;

      document.getElementById('retry-button').addEventListener('click', () => {
        location.reload();
      });
    }

    // Initialize the app when the page loads
    window.addEventListener('load', init);
  </script>
</body>
</html>